services:
  portal:
    image: ghcr.io/gosuda/portal:1
    pull_policy: always
    build:
      context: .
      dockerfile: Dockerfile
    command:
      - "--port"
      - "${PORTAL_PORT:-4017}"
    environment:
      # Core configuration
      PORTAL_URL: ${PORTAL_URL:-http://localhost:${PORTAL_PORT:-4017}}
      BOOTSTRAP_URIS: ${BOOTSTRAP_URIS:-http://localhost:${PORTAL_PORT:-4017}}
      ADMIN_SECRET_KEY: ${ADMIN_SECRET_KEY:-}
      NOINDEX: ${NOINDEX:-}

      # SNI router port (for TLS passthrough)
      SNI_PORT: ${SNI_PORT:-:443}

      # ACME certificate management (optional)
      ACME_DNS_PROVIDER: ${ACME_DNS_PROVIDER:-}
      ACME_EMAIL: ${ACME_EMAIL:-}
      ACME_DIRECTORY: ${ACME_DIRECTORY:-}

      # DNS provider credentials (set as needed)
      CLOUDFLARE_API_TOKEN: ${CLOUDFLARE_API_TOKEN:-}
    ports:
      - "${PORTAL_PORT:-4017}:${PORTAL_PORT:-4017}"
      - "80:80"
      - "443:443"
    restart: unless-stopped
