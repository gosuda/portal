services:
  portal:
    image: ghcr.io/gosuda/portal:1
    pull_policy: always
    build:
      context: .
      dockerfile: Dockerfile
    command:
      - "--port"
      - "${PORTAL_PORT:-4017}"
    environment:
      # Core configuration
      PORTAL_URL: ${PORTAL_URL:-http://localhost:${PORTAL_PORT:-4017}}
      BOOTSTRAP_URIS: ${BOOTSTRAP_URIS:-http://localhost:${PORTAL_PORT:-4017}}
      ADMIN_SECRET_KEY: ${ADMIN_SECRET_KEY:-}
      NOINDEX: ${NOINDEX:-}

      # SNI router port (for TLS passthrough)
      SNI_PORT: ${SNI_PORT:-:443}
      KEYLESS_KEY_FILE: ${KEYLESS_KEY_FILE:-/etc/portal/keyless/privkey.pem}
    ports:
      - "${PORTAL_PORT:-4017}:${PORTAL_PORT:-4017}"
      - "80:80"
      - "443:443"
    restart: unless-stopped
